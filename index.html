<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pan India Projects Tracker</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #e63946;
            --primary-dark: #c1121f;
            --primary-light: #ff8fa3;
            --secondary: #457b9d;
            --light: #f1faee;
            --dark: #1d3557;
            --gray: #a8a8a8;
            --white: #ffffff;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #fafafa;
            color: var(--dark);
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background-color: var(--primary);
            color: white;
            padding: 20px 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2rem;
        }
        
        .logo h1 {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .stats {
            display: flex;
            gap: 20px;
            margin: 20px 0;
        }
        
        .stat-card {
            flex: 1;
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }
        
        .stat-card h3 {
            color: var(--gray);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .stat-card .value {
            font-size: 2rem;
            font-weight: 600;
            color: var(--dark);
        }
        
        .stat-card i {
            font-size: 1.5rem;
            background-color: var(--primary-light);
            color: var(--primary);
            padding: 10px;
            border-radius: 50%;
            margin-bottom: 15px;
        }
        
        .filters {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .filter-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .filter-title h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .filter-content {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .filter-group {
            margin-bottom: 15px;
        }
        
        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark);
        }
        
        .filter-group input, .filter-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }
        
        .filter-group input:focus, .filter-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(230, 57, 70, 0.2);
        }
        
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            justify-content: flex-end;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        
        .btn:active {
            transform: scale(0.98);
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-secondary {
            background-color: var(--light);
            color: var(--dark);
        }
        
        .btn-secondary:hover {
            background-color: #e5e5e5;
        }
        
        .projects-container {
            margin-top: 30px;
        }
        
        .projects-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .projects-header h2 {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .upload-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .upload-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background-color: var(--secondary);
            color: white;
            padding: 10px 16px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        
        .upload-btn:hover {
            background-color: #3d6e8c;
        }
        
        .upload-btn input {
            display: none;
        }
        
        .download-template {
            color: var(--secondary);
            text-decoration: none;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .download-template:hover {
            text-decoration: underline;
        }
        
        .project-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
        }
        
        .project-table th, .project-table td {
            padding: 16px;
            text-align: left;
        }
        
        .project-table th {
            background-color: #f8f8f8;
            font-weight: 600;
            color: var(--dark);
            border-bottom: 1px solid #eee;
        }
        
        .project-table tr {
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s;
        }
        
        .project-table tr:last-child {
            border-bottom: none;
        }
        
        .project-table tr:hover {
            background-color: #f9f9f9;
        }
        
        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-completed {
            background-color: #e3f9e5;
            color: #1b891b;
        }
        
        .status-in-progress {
            background-color: #fff8e6;
            color: #b7791f;
        }
        
        .status-planning {
            background-color: #e6f4ff;
            color: #1a73e8;
        }
        
        .status-delayed {
            background-color: #ffeaea;
            color: #e53935;
        }
        
        .pagination {
            display: flex;
            justify-content: center;
            margin-top: 20px;
            gap: 5px;
        }
        
        .pagination button {
            width: 40px;
            height: 40px;
            border: 1px solid #ddd;
            background-color: white;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .pagination button.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .pagination button:hover:not(.active) {
            background-color: #f5f5f5;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: var(--gray);
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            font-size: 1.5rem;
            margin-bottom: 10px;
            color: var(--dark);
        }
        
        .empty-state p {
            color: var(--gray);
            margin-bottom: 20px;
        }

        /* Notification styles */
        #notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--primary);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: none;
            z-index: 1000;
        }

        .data-management {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .stats {
                flex-direction: column;
            }
            
            .filter-content {
                grid-template-columns: 1fr;
            }
            
            .projects-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .project-table {
                display: block;
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-project-diagram"></i>
                    <h1>Pan India Projects Tracker</h1>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="stats">
            <div class="stat-card">
                <i class="fas fa-tasks"></i>
                <h3>Total Projects</h3>
                <div class="value" id="total-projects">0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-spinner"></i>
                <h3>In Progress</h3>
                <div class="value" id="in-progress">0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-check-circle"></i>
                <h3>Completed</h3>
                <div class="value" id="completed">0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-clipboard-list"></i>
                <h3>Planning</h3>
                <div class="value" id="planning">0</div>
            </div>
            <div class="stat-card">
                <i class="fas fa-clock"></i>
                <h3>Delayed</h3>
                <div class="value" id="delayed">0</div>
            </div>
        </div>
        
        <div class="filters">
            <div class="filter-title">
                <h2>Filter Projects</h2>
            </div>
            <div class="filter-content">
                <div class="filter-group">
                    <label for="project-name">Project Name</label>
                    <input type="text" id="project-name" placeholder="Search by project name">
                </div>
                <div class="filter-group">
                    <label for="company-name">Company Name</label>
                    <input type="text" id="company-name" placeholder="Search by company name">
                </div>
                <div class="filter-group">
                    <label for="company-location">Company Location</label>
                    <input type="text" id="company-location" placeholder="Search by company location">
                </div>
                <div class="filter-group">
                    <label for="budget">Budget Range (Cr ₹)</label>
                    <select id="budget">
                        <option value="">All Budgets</option>
                        <option value="0-10">0 - 10 Cr</option>
                        <option value="10-50">10 - 50 Cr</option>
                        <option value="50-100">50 - 100 Cr</option>
                        <option value="100-500">100 - 500 Cr</option>
                        <option value="500+">500+ Cr</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label for="site-location">Site Location</label>
                    <input type="text" id="site-location" placeholder="Search by site location">
                </div>
                <div class="filter-group">
                    <label for="status">Status</label>
                    <select id="status">
                        <option value="">All Status</option>
                        <option value="Completed">Completed</option>
                        <option value="In Progress">In Progress</option>
                        <option value="Planning">Planning</option>
                        <option value="Delayed">Delayed</option>
                    </select>
                </div>
            </div>
            <div class="actions">
                <button class="btn btn-secondary" id="reset-filters">Reset Filters</button>
                <button class="btn btn-primary" id="apply-filters">Apply Filters</button>
            </div>
            <div class="filter-results" id="filter-results" style="display: none; margin-top: 15px; padding: 10px; background-color: #f8f8f8; border-radius: 6px;">
                <span><strong>Filtered Results:</strong> <span id="filtered-count">0</span> projects found</span>
            </div>
        </div>
        
        <div class="projects-container">
            <div class="projects-header">
                <h2>Projects List</h2>
                <div class="upload-container">
                    <label class="upload-btn">
                        <i class="fas fa-upload"></i>
                        Upload Excel
                        <input type="file" id="excel-upload" accept=".xlsx, .xls, .csv">
                    </label>
                    <a href="#" class="download-template" id="download-template">
                        <i class="fas fa-file-download"></i>
                        Download Template
                    </a>
                </div>
            </div>
            
            <div class="data-management">
                <button class="btn btn-secondary" id="export-data">
                    <i class="fas fa-file-export"></i> Export Data
                </button>
                <button class="btn btn-secondary" id="clear-data">
                    <i class="fas fa-trash-alt"></i> Clear All Data
                </button>
                <button class="btn btn-secondary" id="backup-data">
                    <i class="fas fa-save"></i> Backup Data
                </button>
                <button class="btn btn-secondary" id="restore-data">
                    <i class="fas fa-upload"></i> Restore Backup
                </button>
                <input type="file" id="restore-upload" accept=".json" style="display: none;">
            </div>
            
            <div id="projects-table-container">
                <div class="empty-state">
                    <i class="fas fa-folder-open"></i>
                    <h3>No Projects Found</h3>
                    <p>Upload an Excel file with project data or click on the sample data button below</p>
                    <button class="btn btn-primary" id="load-sample">Load Sample Data</button>
                </div>
            </div>
            
            <div class="pagination" id="pagination">
                <!-- Pagination buttons will be added dynamically -->
            </div>
        </div>
    </div>
    
    <!-- Notification element -->
    <div id="notification" style="display: none;">
        <span id="notification-message">Data saved successfully!</span>
    </div>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Sample data for demonstration
        const sampleData = [
            {
                id: 1,
                projectName: "Mumbai Metro Line 3",
                companyName: "Mumbai Metro Rail Corporation",
                companyLocation: "Mumbai, Maharashtra",
                budget: 231.36,
                siteLocation: "Colaba-Bandra-SEEPZ, Mumbai",
                status: "In Progress"
            },
            {
                id: 2,
                projectName: "Delhi-Meerut RRTS",
                companyName: "National Capital Region Transport Corporation",
                companyLocation: "Delhi",
                budget: 300.00,
                siteLocation: "Delhi-Meerut Corridor",
                status: "In Progress"
            },
            {
                id: 3,
                projectName: "Statue of Unity",
                companyName: "Larsen & Toubro",
                companyLocation: "Mumbai, Maharashtra",
                budget: 29.89,
                siteLocation: "Kevadia, Gujarat",
                status: "Completed"
            },
            {
                id: 4,
                projectName: "Bharatmala Pariyojana Phase I",
                companyName: "National Highways Authority of India",
                companyLocation: "New Delhi",
                budget: 535.00,
                siteLocation: "Pan India",
                status: "In Progress"
            },
            {
                id: 5,
                projectName: "Navi Mumbai International Airport",
                companyName: "Adani Group",
                companyLocation: "Ahmedabad, Gujarat",
                budget: 160.00,
                siteLocation: "Navi Mumbai, Maharashtra",
                status: "Planning"
            },
            {
                id: 6,
                projectName: "Mumbai Coastal Road",
                companyName: "Municipal Corporation of Greater Mumbai",
                companyLocation: "Mumbai, Maharashtra",
                budget: 126.21,
                siteLocation: "South Mumbai to Northern Suburbs",
                status: "In Progress"
            },
            {
                id: 7,
                projectName: "Chennai Metro Phase II",
                companyName: "Chennai Metro Rail Limited",
                companyLocation: "Chennai, Tamil Nadu",
                budget: 619.68,
                siteLocation: "Chennai Metropolitan Area",
                status: "Planning"
            },
            {
                id: 8,
                projectName: "Amaravati Capital City",
                companyName: "Andhra Pradesh Capital Region Development Authority",
                companyLocation: "Vijayawada, Andhra Pradesh",
                budget: 500.00,
                siteLocation: "Amaravati, Andhra Pradesh",
                status: "Delayed"
            },
            {
                id: 9,
                projectName: "Bullet Train Project",
                companyName: "National High Speed Rail Corporation Limited",
                companyLocation: "New Delhi",
                budget: 1080.00,
                siteLocation: "Mumbai-Ahmedabad",
                status: "In Progress"
            },
            {
                id: 10,
                projectName: "Atal Mission for Rejuvenation and Urban Transformation",
                companyName: "Ministry of Housing and Urban Affairs",
                companyLocation: "New Delhi",
                budget: 77.30,
                siteLocation: "500 cities across India",
                status: "In Progress"
            },
            {
                id: 11,
                projectName: "Pragati Maidan Redevelopment",
                companyName: "India Trade Promotion Organisation",
                companyLocation: "New Delhi",
                budget: 28.22,
                siteLocation: "New Delhi",
                status: "Completed"
            },
            {
                id: 12,
                projectName: "Eastern Dedicated Freight Corridor",
                companyName: "Dedicated Freight Corridor Corporation of India",
                companyLocation: "New Delhi",
                budget: 302.74,
                siteLocation: "Punjab-West Bengal",
                status: "In Progress"
            },
            {
                id: 13,
                projectName: "Nagpur Metro",
                companyName: "Maharashtra Metro Rail Corporation",
                companyLocation: "Nagpur, Maharashtra",
                budget: 86.80,
                siteLocation: "Nagpur, Maharashtra",
                status: "Completed"
            },
            {
                id: 14,
                projectName: "Polavaram Irrigation Project",
                companyName: "Water Resources Department, Andhra Pradesh",
                companyLocation: "Amaravati, Andhra Pradesh",
                budget: 550.48,
                siteLocation: "West Godavari, Andhra Pradesh",
                status: "Delayed"
            },
            {
                id: 15,
                projectName: "GIFT City",
                companyName: "Gujarat International Finance Tec-City Company Ltd",
                companyLocation: "Gandhinagar, Gujarat",
                budget: 780.00,
                siteLocation: "Gandhinagar, Gujarat",
                status: "In Progress"
            }
        ];

        let allProjects = [];
        let filteredProjects = [];
        let currentPage = 1;
        const projectsPerPage = 10;
        
        // IndexedDB configuration
        const DB_NAME = 'IndiaProjectsDB';
        const DB_VERSION = 1;
        const PROJECTS_STORE = 'projects';
        let db;
        
        // DOM Elements
        const projectNameFilter = document.getElementById('project-name');
        const companyNameFilter = document.getElementById('company-name');
        const companyLocationFilter = document.getElementById('company-location');
        const budgetFilter = document.getElementById('budget');
        const siteLocationFilter = document.getElementById('site-location');
        const statusFilter = document.getElementById('status');
        const resetFiltersBtn = document.getElementById('reset-filters');
        const applyFiltersBtn = document.getElementById('apply-filters');
        const loadSampleBtn = document.getElementById('load-sample');
        const excelUpload = document.getElementById('excel-upload');
        const downloadTemplateBtn = document.getElementById('download-template');
        const projectsTableContainer = document.getElementById('projects-table-container');
        const paginationContainer = document.getElementById('pagination');
        const exportDataBtn = document.getElementById('export-data');
        const clearDataBtn = document.getElementById('clear-data');
        const backupDataBtn = document.getElementById('backup-data');
        const restoreDataBtn = document.getElementById('restore-data');
        const restoreUpload = document.getElementById('restore-upload');

        // Statistics elements
        const totalProjectsElement = document.getElementById('total-projects');
        const inProgressElement = document.getElementById('in-progress');
        const completedElement = document.getElementById('completed');
        const planningElement = document.getElementById('planning');
        const delayedElement = document.getElementById('delayed');
        
        // Initialize IndexedDB
        function initIndexedDB() {
            return new Promise((resolve, reject) => {
                const request = indexedDB.open(DB_NAME, DB_VERSION);
                
                request.onerror = event => {
                    console.error('IndexedDB error:', event.target.error);
                    showNotification('Database error. Falling back to localStorage.', 'error');
                    resolve(false);
                };
                
                request.onsuccess = event => {
                    db = event.target.result;
                    console.log('Database opened successfully');
                    resolve(true);
                };
                
                request.onupgradeneeded = event => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(PROJECTS_STORE)) {
                        const store = db.createObjectStore(PROJECTS_STORE, { keyPath: 'id', autoIncrement: true });
                        store.createIndex('status', 'status', { unique: false });
                        store.createIndex('projectName', 'projectName', { unique: false });
                        store.createIndex('companyName', 'companyName', { unique: false });
                    }
                };
            });
        }
        
        // Function to save projects to IndexedDB
        function saveProjectsToIndexedDB(projects) {
            return new Promise((resolve, reject) => {
                if (!db) {
                    saveProjectsToLocalStorage(projects);
                    resolve(false);
                    return;
                }
                
                const transaction = db.transaction([PROJECTS_STORE], 'readwrite');
                const store = transaction.objectStore(PROJECTS_STORE);
                
                // Clear existing data
                const clearRequest = store.clear();
                
                clearRequest.onsuccess = () => {
                    // Add all projects
                    let counter = 0;
                    
                    projects.forEach(project => {
                        const request = store.add(project);
                        
                        request.onsuccess = () => {
                            counter++;
                            if (counter === projects.length) {
                                // Also save to localStorage as backup
                                try {
                                    localStorage.setItem('indiaProjectsData', JSON.stringify(projects));
                                } catch (e) {
                                    console.warn('localStorage quota exceeded, using IndexedDB only');
                                }
                                
                                showNotification('Data saved successfully!');
                                resolve(true);
                            }
                        };
                        
                        request.onerror = event => {
                            console.error('Error adding project:', event.target.error);
                            reject(event.target.error);
                        };
                    });
                };
                
                clearRequest.onerror = event => {
                    console.error('Error clearing store:', event.target.error);
                    reject(event.target.error);
                };
            });
        }
        
        // Function to load projects from IndexedDB
        function loadProjectsFromIndexedDB() {
            return new Promise((resolve, reject) => {
                if (!db) {
                    const data = loadProjectsFromLocalStorage();
                    resolve(data);
                    return;
                }
                
                const transaction = db.transaction([PROJECTS_STORE], 'readonly');
                const store = transaction.objectStore(PROJECTS_STORE);
                const request = store.getAll();
                
                request.onsuccess = event => {
                    resolve(event.target.result);
                };
                
                request.onerror = event => {
                    console.error('Error loading projects:', event.target.error);
                    // Fallback to localStorage
                    const data = loadProjectsFromLocalStorage();
                    resolve(data);
                };
            });
        }
        
        // Functions to save and load data from localStorage
        function saveProjectsToLocalStorage(projects) {
            try {
                localStorage.setItem('indiaProjectsData', JSON.stringify(projects));
                localStorage.setItem('lastDataUpdateTime', new Date().toISOString());
                showNotification('Data saved successfully!');
                return true;
            } catch (error) {
                console.error('Error saving to localStorage:', error);
                if (error.name === 'QuotaExceededError') {
                    showNotification('Storage limit exceeded. Try using the backup function instead.', 'error');
                } else {
                    showNotification('Error saving data. Please try again.', 'error');
                }
                return false;
            }
        }

        function loadProjectsFromLocalStorage() {
            const savedData = localStorage.getItem('indiaProjectsData');
            return savedData ? JSON.parse(savedData) : null;
        }

        // Function to show notifications to the user
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationMessage = document.getElementById('notification-message');
            
            // Set message
            notificationMessage.textContent = message;
            
            // Set background color based on type
            if (type === 'success') {
                notification.style.backgroundColor = 'var(--primary)';
            } else if (type === 'error') {
                notification.style.backgroundColor = '#e53935';
            } else if (type === 'warning') {
                notification.style.backgroundColor = '#fb8c00';
            } else if (type === 'info') {
                notification.style.backgroundColor = 'var(--secondary)';
            }
            
            // Show notification
            notification.style.display = 'block';
            
            // Hide after 3 seconds
            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }
        
        // Functions
       function resetFilters() {
            projectNameFilter.value = '';
            companyNameFilter.value = '';
            companyLocationFilter.value = '';
            budgetFilter.value = '';
            siteLocationFilter.value = '';
            statusFilter.value = '';
            
            // Hide filtered results counter
            document.getElementById('filter-results').style.display = 'none';
            
            if (allProjects.length > 0) {
                filteredProjects = [...allProjects];
                currentPage = 1;
                renderProjects();
                updateStats();
            }
        }
        
        function applyFilters() {
            const projectName = projectNameFilter.value.toLowerCase();
            const companyName = companyNameFilter.value.toLowerCase();
            const companyLocation = companyLocationFilter.value.toLowerCase();
            const budget = budgetFilter.value;
            const siteLocation = siteLocationFilter.value.toLowerCase();
            const status = statusFilter.value;
            
            filteredProjects = allProjects.filter(project => {
                let budgetMatch = true;
                
                if (budget) {
                    const projectBudget = project.budget;
                    
                    if (budget === '0-10') {
                        budgetMatch = projectBudget >= 0 && projectBudget <= 10;
                    } else if (budget === '10-50') {
                        budgetMatch = projectBudget > 10 && projectBudget <= 50;
                    } else if (budget === '50-100') {
                        budgetMatch = projectBudget > 50 && projectBudget <= 100;
                    } else if (budget === '100-500') {
                        budgetMatch = projectBudget > 100 && projectBudget <= 500;
                    } else if (budget === '500+') {
                        budgetMatch = projectBudget > 500;
                    }
                }
                
                return (
                    (!projectName || project.projectName.toLowerCase().includes(projectName)) &&
                    (!companyName || project.companyName.toLowerCase().includes(companyName)) &&
                    (!companyLocation || project.companyLocation.toLowerCase().includes(companyLocation)) &&
                    budgetMatch &&
                    (!siteLocation || project.siteLocation.toLowerCase().includes(siteLocation)) &&
                    (!status || project.status === status)
                );
            });
            
            // Show filtered results counter
            const filterResults = document.getElementById('filter-results');
            const filteredCount = document.getElementById('filtered-count');
            filteredCount.textContent = filteredProjects.length;
            filterResults.style.display = 'block';
            
            currentPage = 1;
            renderProjects();
        }
        
        function renderProjects() {
            if (filteredProjects.length === 0) {
                projectsTableContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-search"></i>
                        <h3>No Projects Found</h3>
                        <p>Try adjusting your filters or upload new data</p>
                        <button class="btn btn-primary" id="load-sample">Load Sample Data</button>
                    </div>
                `;
                document.getElementById('load-sample').addEventListener('click', loadSampleData);
                paginationContainer.innerHTML = '';
                return;
            }
            
            // Pagination
            const totalPages = Math.ceil(filteredProjects.length / projectsPerPage);
            const startIndex = (currentPage - 1) * projectsPerPage;
            const endIndex = Math.min(startIndex + projectsPerPage, filteredProjects.length);
            const currentProjects = filteredProjects.slice(startIndex, endIndex);
            
            // Render the table
            let tableHTML = `
                <table class="project-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Project Name</th>
                            <th>Company</th>
                            <th>Company Location</th>
                            <th>Budget (Cr ₹)</th>
                            <th>Site Location</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            currentProjects.forEach(project => {
                let statusClass = '';
                if (project.status === 'Completed') statusClass = 'status-completed';
                else if (project.status === 'In Progress') statusClass = 'status-in-progress';
                else if (project.status === 'Planning') statusClass = 'status-planning';
                else if (project.status === 'Delayed') statusClass = 'status-delayed';
                
                tableHTML += `
                    <tr>
                        <td>${project.id}</td>
                        <td>${project.projectName}</td>
                        <td>${project.companyName}</td>
                        <td>${project.companyLocation}</td>
                        <td>${project.budget.toFixed(2)}</td>
                        <td>${project.siteLocation}</td>
                        <td><span class="status ${statusClass}">${project.status}</span></td>
                    </tr>
                `;
            });
            
            tableHTML += `
                    </tbody>
                </table>
            `;
            
            projectsTableContainer.innerHTML = tableHTML;
            
            // Render pagination
            renderPagination(totalPages);
        }
        
        function renderPagination(totalPages) {
            if (totalPages <= 1) {
                paginationContainer.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <button ${currentPage === 1 ? 'disabled' : ''} onclick="changePage(${currentPage - 1})">
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;
            
            // Page numbers
            const maxPageButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPageButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxPageButtons - 1);
            
            if (endPage - startPage + 1 < maxPageButtons) {
                startPage = Math.max(1, endPage - maxPageButtons + 1);
            }
            
            for (let i = startPage; i <= endPage; i++) {
                paginationHTML += `
                    <button class="${i === currentPage ? 'active' : ''}" onclick="changePage(${i})">
                        ${i}
                    </button>
                `;
            }
            
            // Next button
            paginationHTML += `
                <button ${currentPage === totalPages ? 'disabled' : ''} onclick="changePage(${currentPage + 1})">
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;
            
            paginationContainer.innerHTML = paginationHTML;
        }
        
        function changePage(page) {
            currentPage = page;
            renderProjects();
            // Scroll to the top of the table
            projectsTableContainer.scrollIntoView({ behavior: 'smooth' });
        }
        
        function updateStats() {
            // Count projects by status
            const stats = {
                total: allProjects.length,
                inProgress: allProjects.filter(p => p.status === 'In Progress').length,
                completed: allProjects.filter(p => p.status === 'Completed').length,
                planning: allProjects.filter(p => p.status === 'Planning').length,
                delayed: allProjects.filter(p => p.status === 'Delayed').length
            };
            
            // Update the DOM
            totalProjectsElement.textContent = stats.total;
            inProgressElement.textContent = stats.inProgress;
            completedElement.textContent = stats.completed;
            planningElement.textContent = stats.planning;
            delayedElement.textContent = stats.delayed;
        }
        
        function loadSampleData() {
            allProjects = [...sampleData];
            filteredProjects = [...sampleData];
            saveProjectsToIndexedDB(allProjects)
                .then(() => {
                    showNotification('Sample data loaded successfully!');
                    renderProjects();
                    updateStats();
                })
                .catch(error => {
                    console.error('Error saving sample data:', error);
                    showNotification('Error loading sample data. Please try again.', 'error');
                });
        }
        
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = e.target.result;
                    const workbook = XLSX.read(data, { type: 'binary' });
                    const sheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[sheetName];
                    const jsonData = XLSX.utils.sheet_to_json(worksheet);
                    
                    // Process the data
                    if (jsonData.length > 0) {
                        processImportedData(jsonData);
                    } else {
                        showNotification('No data found in the uploaded file.', 'warning');
                    }
                } catch (error) {
                    console.error('Error processing Excel file:', error);
                    showNotification('Error processing the file. Please check the format.', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Error reading the file. Please try again.', 'error');
            };
            
            reader.readAsBinaryString(file);
        }
        
        function processImportedData(jsonData) {
            // Map imported data to our schema
            const processedData = jsonData.map((item, index) => {
                return {
                    id: allProjects.length > 0 ? Math.max(...allProjects.map(p => p.id)) + index + 1 : index + 1,
                    projectName: item['Project Name'] || item['projectName'] || 'Untitled Project',
                    companyName: item['Company Name'] || item['companyName'] || 'Unknown Company',
                    companyLocation: item['Company Location'] || item['companyLocation'] || 'Unknown Location',
                    budget: parseFloat(item['Budget (Cr ₹)'] || item['budget'] || 0),
                    siteLocation: item['Site Location'] || item['siteLocation'] || 'Unknown Site',
                    status: item['Status'] || item['status'] || 'Planning'
                };
            });
            
            // Add to existing projects
            allProjects = [...allProjects, ...processedData];
            filteredProjects = [...allProjects];
            
            // Save to storage
            saveProjectsToIndexedDB(allProjects)
                .then(() => {
                    showNotification(`${processedData.length} projects imported successfully!`);
                    renderProjects();
                    updateStats();
                })
                .catch(error => {
                    console.error('Error saving imported data:', error);
                    showNotification('Error saving imported data. Please try again.', 'error');
                });
        }
        
        function downloadTemplate() {
            // Create a sample template
            const template = [
                {
                    'Project Name': 'Sample Project',
                    'Company Name': 'Sample Company',
                    'Company Location': 'City, State',
                    'Budget (Cr ₹)': 100,
                    'Site Location': 'Project Site Location',
                    'Status': 'Planning'
                }
            ];
            
            // Convert to worksheet
            const worksheet = XLSX.utils.json_to_sheet(template);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Template');
            
            // Generate Excel file
            XLSX.writeFile(workbook, 'india_projects_template.xlsx');
        }
        
        function exportData() {
            if (allProjects.length === 0) {
                showNotification('No data to export.', 'warning');
                return;
            }
            
            // Convert to worksheet
            const worksheet = XLSX.utils.json_to_sheet(allProjects);
            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Projects');
            
            // Generate Excel file
            XLSX.writeFile(workbook, `india_projects_export_${new Date().toISOString().split('T')[0]}.xlsx`);
        }
        
        function clearAllData() {
            if (confirm('Are you sure you want to delete all projects? This action cannot be undone.')) {
                allProjects = [];
                filteredProjects = [];
                
                // Clear from storage
                if (db) {
                    const transaction = db.transaction([PROJECTS_STORE], 'readwrite');
                    const store = transaction.objectStore(PROJECTS_STORE);
                    const request = store.clear();
                    
                    request.onsuccess = () => {
                        localStorage.removeItem('indiaProjectsData');
                        showNotification('All data has been cleared.');
                        renderProjects();
                        updateStats();
                    };
                    
                    request.onerror = event => {
                        console.error('Error clearing data:', event.target.error);
                        showNotification('Error clearing data. Please try again.', 'error');
                    };
                } else {
                    localStorage.removeItem('indiaProjectsData');
                    showNotification('All data has been cleared.');
                    renderProjects();
                    updateStats();
                }
            }
        }
        
        function backupData() {
            if (allProjects.length === 0) {
                showNotification('No data to backup.', 'warning');
                return;
            }
            
            // Create a backup file
            const dataStr = JSON.stringify(allProjects);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            // Create download link
            const link = document.createElement('a');
            link.href = url;
            link.download = `india_projects_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification('Backup created successfully!');
        }
        
        function restoreBackup() {
            restoreUpload.click();
        }
        
        function handleBackupFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const restoredData = JSON.parse(e.target.result);
                    
                    if (Array.isArray(restoredData) && restoredData.length > 0) {
                        allProjects = restoredData;
                        filteredProjects = [...restoredData];
                        
                        // Save to storage
                        saveProjectsToIndexedDB(allProjects)
                            .then(() => {
                                showNotification(`${restoredData.length} projects restored successfully!`);
                                renderProjects();
                                updateStats();
                            })
                            .catch(error => {
                                console.error('Error saving restored data:', error);
                                showNotification('Error restoring backup. Please try again.', 'error');
                            });
                    } else {
                        showNotification('Invalid backup file. No projects found.', 'error');
                    }
                } catch (error) {
                    console.error('Error parsing backup file:', error);
                    showNotification('Error parsing backup file. Please check the format.', 'error');
                }
            };
            
            reader.onerror = function() {
                showNotification('Error reading the backup file. Please try again.', 'error');
            };
            
            reader.readAsText(file);
        }
        
        // Initialize App
        async function initApp() {
            // Initialize IndexedDB
            const dbInitialized = await initIndexedDB();
            
            // Load saved data
            const savedProjects = await loadProjectsFromIndexedDB();
            
            if (savedProjects && savedProjects.length > 0) {
                allProjects = savedProjects;
                filteredProjects = [...savedProjects];
                renderProjects();
                updateStats();
            } else {
                // Show empty state
                projectsTableContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-folder-open"></i>
                        <h3>No Projects Found</h3>
                        <p>Upload an Excel file with project data or click on the sample data button below</p>
                        <button class="btn btn-primary" id="load-sample">Load Sample Data</button>
                    </div>
                `;
                document.getElementById('load-sample').addEventListener('click', loadSampleData);
            }
            
            // Event Listeners
            resetFiltersBtn.addEventListener('click', resetFilters);
            applyFiltersBtn.addEventListener('click', applyFilters);
            excelUpload.addEventListener('change', handleFileUpload);
            downloadTemplateBtn.addEventListener('click', downloadTemplate);
            exportDataBtn.addEventListener('click', exportData);
            clearDataBtn.addEventListener('click', clearAllData);
            backupDataBtn.addEventListener('click', backupData);
            restoreDataBtn.addEventListener('click', restoreBackup);
            restoreUpload.addEventListener('change', handleBackupFileUpload);
            
            // Initialize event delegation for dynamically created elements
            document.addEventListener('click', function(event) {
                if (event.target && event.target.id === 'load-sample') {
                    loadSampleData();
                }
            });
            
            // Make changePage function global
            window.changePage = changePage;
        }
        
        // Start the app
        initApp();
           
